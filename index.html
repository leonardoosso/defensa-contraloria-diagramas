<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estrategia Defensa PRF-80011 — Analisis V2</title>
<!--
  Estrategia de defensa ante Contraloria General de la Republica
  Proceso de Responsabilidad Fiscal PRF-80011
  Aesthetic: Editorial (serif headlines, generous whitespace, muted palette)
  Data source: V2 PDF analysis + defense arguments compilation
-->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&family=Crimson+Pro:wght@400;500;600&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  /* ============ THEME — Editorial (light-first) ============ */
  :root {
    --font-display: 'Playfair Display', 'Georgia', serif;
    --font-body: 'Crimson Pro', 'Georgia', serif;
    --font-mono: 'JetBrains Mono', 'SF Mono', Consolas, monospace;

    --bg: #faf8f5;
    --surface: #ffffff;
    --surface2: #f3f0eb;
    --surface-elevated: #fffcf8;
    --border: rgba(0, 0, 0, 0.07);
    --border-bright: rgba(0, 0, 0, 0.14);
    --text: #1c1a17;
    --text-dim: #7a756d;
    --text-muted: #a09a90;

    --red: #b91c1c;
    --red-dim: rgba(185, 28, 28, 0.07);
    --green: #15803d;
    --green-dim: rgba(21, 128, 61, 0.07);
    --blue: #1d4ed8;
    --blue-dim: rgba(29, 78, 216, 0.07);
    --amber: #b45309;
    --amber-dim: rgba(180, 83, 9, 0.07);
    --purple: #7e22ce;
    --purple-dim: rgba(126, 34, 206, 0.07);
    --teal: #0f766e;
    --teal-dim: rgba(15, 118, 110, 0.07);

    --accent: #8b5e3c;
    --accent-dim: rgba(139, 94, 60, 0.06);
  }

  [data-theme="dark"] {
    --bg: #141210;
    --surface: #1e1c19;
    --surface2: #282520;
    --surface-elevated: #302d27;
    --border: rgba(255, 255, 255, 0.06);
    --border-bright: rgba(255, 255, 255, 0.12);
    --text: #ede8e0;
    --text-dim: #a09a90;
    --text-muted: #6b665e;

    --red: #f87171;
    --red-dim: rgba(248, 113, 113, 0.12);
    --green: #4ade80;
    --green-dim: rgba(74, 222, 128, 0.1);
    --blue: #93c5fd;
    --blue-dim: rgba(147, 197, 253, 0.1);
    --amber: #fbbf24;
    --amber-dim: rgba(251, 191, 36, 0.1);
    --purple: #c4b5fd;
    --purple-dim: rgba(196, 181, 253, 0.1);
    --teal: #5eead4;
    --teal-dim: rgba(94, 234, 212, 0.1);

    --accent: #d4a574;
    --accent-dim: rgba(212, 165, 116, 0.1);
  }

  /* ============ RESET + BASE ============ */
  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    background-image:
      radial-gradient(ellipse at 25% 0%, var(--accent-dim) 0%, transparent 50%),
      radial-gradient(ellipse at 75% 100%, var(--green-dim) 0%, transparent 40%);
    color: var(--text);
    font-family: var(--font-body);
    font-size: 16px;
    line-height: 1.6;
    padding: 40px;
    min-height: 100vh;
    overflow-wrap: break-word;
  }

  /* ============ ANIMATION ============ */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(14px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes fadeScale {
    from { opacity: 0; transform: scale(0.92); }
    to { opacity: 1; transform: scale(1); }
  }

  .animate {
    animation: fadeUp 0.45s ease-out both;
    animation-delay: calc(var(--i, 0) * 0.06s);
  }
  .animate-scale {
    animation: fadeScale 0.4s ease-out both;
    animation-delay: calc(var(--i, 0) * 0.06s);
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-delay: 0ms !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* ============ WRAP + NAV ============ */
  .wrap {
    max-width: 1400px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 180px 1fr;
    gap: 0 44px;
  }
  .main { min-width: 0; max-width: 960px; }

  .toc {
    position: sticky;
    top: 24px;
    align-self: start;
    padding: 14px 0;
    grid-row: 1 / -1;
    max-height: calc(100dvh - 48px);
    overflow-y: auto;
  }
  .toc::-webkit-scrollbar { width: 3px; }
  .toc::-webkit-scrollbar-thumb { background: var(--surface-elevated); border-radius: 2px; }

  .toc-title {
    font-family: var(--font-mono);
    font-size: 9px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--text-dim);
    padding: 0 0 10px;
    margin-bottom: 8px;
    border-bottom: 1px solid var(--border);
  }

  .toc a {
    display: block;
    font-family: var(--font-mono);
    font-size: 10.5px;
    color: var(--text-dim);
    text-decoration: none;
    padding: 4px 8px;
    border-radius: 5px;
    border-left: 2px solid transparent;
    transition: all 0.15s;
    line-height: 1.4;
    margin-bottom: 1px;
  }
  .toc a:hover { color: var(--text); background: var(--surface2); }
  .toc a.active { color: var(--text); border-left-color: var(--accent); }

  /* ============ THEME TOGGLE ============ */
  .theme-toggle {
    position: fixed;
    top: 16px;
    right: 16px;
    z-index: 300;
    width: 36px;
    height: 36px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--surface);
    color: var(--text-dim);
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s, color 0.15s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }
  .theme-toggle:hover { color: var(--text); background: var(--surface-elevated); }

  /* ============ SECTION HEADINGS ============ */
  .sec-head {
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2.5px;
    padding: 10px 0 6px;
    margin-top: 56px;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--border-bright);
    color: var(--text-dim);
    scroll-margin-top: 20px;
  }

  h2 {
    font-family: var(--font-display);
    font-size: 30px;
    font-weight: 700;
    letter-spacing: -0.5px;
    margin-bottom: 12px;
    text-wrap: balance;
  }

  .section-intro {
    color: var(--text-dim);
    font-size: 17px;
    line-height: 1.65;
    max-width: 680px;
    margin-bottom: 28px;
  }

  /* ============ HERO SECTION ============ */
  .hero {
    margin-bottom: 32px;
  }
  .hero h1 {
    font-family: var(--font-display);
    font-size: 42px;
    font-weight: 800;
    letter-spacing: -1.5px;
    line-height: 1.15;
    margin-bottom: 8px;
    text-wrap: balance;
  }
  .hero-subtitle {
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--text-dim);
    margin-bottom: 32px;
    letter-spacing: 0.5px;
  }

  .kpi-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 24px;
  }

  .kpi-card {
    background: var(--surface-elevated);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 22px 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.04);
    position: relative;
    overflow: hidden;
  }

  .kpi-card__value {
    font-family: var(--font-display);
    font-size: 36px;
    font-weight: 700;
    line-height: 1.1;
    font-variant-numeric: tabular-nums;
    letter-spacing: -1px;
  }

  .kpi-card__label {
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-dim);
    margin-top: 6px;
  }

  .kpi-card__badge {
    display: inline-block;
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 5px;
    margin-top: 6px;
    letter-spacing: 0.3px;
  }

  .badge-red { background: var(--red-dim); color: var(--red); }
  .badge-green { background: var(--green-dim); color: var(--green); }
  .badge-blue { background: var(--blue-dim); color: var(--blue); }
  .badge-amber { background: var(--amber-dim); color: var(--amber); }
  .badge-purple { background: var(--purple-dim); color: var(--purple); }

  .veredicto {
    background: var(--green-dim);
    border: 1px solid var(--green);
    border-radius: 12px;
    padding: 20px 28px;
    text-align: center;
  }
  .veredicto__text {
    font-family: var(--font-display);
    font-size: 22px;
    font-weight: 700;
    color: var(--green);
    letter-spacing: -0.3px;
  }
  .veredicto__sub {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--text-dim);
    margin-top: 4px;
  }

  /* ============ TABLE STYLES ============ */
  .table-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 24px;
  }
  .table-scroll {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    line-height: 1.55;
  }
  .data-table thead {
    position: sticky;
    top: 0;
    z-index: 2;
  }
  .data-table th {
    background: var(--surface2);
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    color: var(--text-dim);
    text-align: left;
    padding: 14px 16px;
    border-bottom: 2px solid var(--border-bright);
    white-space: nowrap;
  }
  .data-table td {
    padding: 14px 16px;
    border-bottom: 1px solid var(--border);
    vertical-align: top;
  }
  .data-table tbody tr:last-child td { border-bottom: none; }
  .data-table .wide { min-width: 200px; max-width: 440px; }
  .data-table tbody tr:nth-child(even) { background: var(--accent-dim); }
  .data-table tbody tr {
    transition: background 0.15s ease;
    animation: fadeUp 0.35s ease-out both;
    animation-delay: calc(var(--i, 0) * 0.04s);
  }
  .data-table tbody tr:hover { background: var(--border); }
  .data-table td.num, .data-table th.num {
    text-align: right;
    font-variant-numeric: tabular-nums;
    font-family: var(--font-mono);
    font-size: 13px;
  }
  .data-table tfoot td {
    background: var(--surface2);
    font-weight: 600;
    font-family: var(--font-mono);
    font-size: 12px;
    border-top: 2px solid var(--border-bright);
    border-bottom: none;
    padding: 14px 16px;
  }
  .data-table small {
    display: block;
    color: var(--text-dim);
    font-size: 12px;
    margin-top: 3px;
  }

  /* ============ STATUS BADGES ============ */
  .status {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 600;
    padding: 3px 10px;
    border-radius: 6px;
    white-space: nowrap;
    letter-spacing: 0.3px;
  }
  .status::before {
    content: '';
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: currentColor;
  }
  .status--vigente { background: var(--green-dim); color: var(--green); }
  .status--actualiza { background: var(--blue-dim); color: var(--blue); }
  .status--parcial { background: var(--amber-dim); color: var(--amber); }
  .status--victoria { background: var(--green-dim); color: var(--green); }
  .status--red { background: var(--red-dim); color: var(--red); }

  /* ============ MERMAID CONTAINER ============ */
  .mermaid-wrap {
    position: relative;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 32px 24px;
    overflow: auto;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 24px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }
  .mermaid-wrap::-webkit-scrollbar { width: 6px; height: 6px; }
  .mermaid-wrap::-webkit-scrollbar-track { background: transparent; }
  .mermaid-wrap::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  .mermaid-wrap::-webkit-scrollbar-thumb:hover { background: var(--text-dim); }

  .mermaid-wrap .mermaid {
    transition: transform 0.2s ease;
    transform-origin: center center;
  }

  .zoom-controls {
    position: absolute;
    top: 8px;
    right: 8px;
    display: flex;
    gap: 2px;
    z-index: 10;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 2px;
  }
  .zoom-controls button {
    width: 28px;
    height: 28px;
    border: none;
    background: transparent;
    color: var(--text-dim);
    font-family: var(--font-mono);
    font-size: 14px;
    cursor: pointer;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s ease, color 0.15s ease;
  }
  .zoom-controls button:hover {
    background: var(--border);
    color: var(--text);
  }
  .mermaid-wrap.is-zoomed { cursor: grab; }
  .mermaid-wrap.is-panning { cursor: grabbing; user-select: none; }

  /* ============ MERMAID SVG OVERRIDES ============ */
  .mermaid .nodeLabel {
    font-family: var(--font-body) !important;
    font-size: 15px !important;
    color: var(--text) !important;
  }
  .mermaid .edgeLabel {
    font-family: var(--font-mono) !important;
    font-size: 12px !important;
    color: var(--text-dim) !important;
    background-color: var(--bg) !important;
  }
  .mermaid .edgeLabel rect {
    fill: var(--bg) !important;
  }
  .mermaid .node rect,
  .mermaid .node circle,
  .mermaid .node polygon {
    stroke-width: 1.5px !important;
  }
  .mermaid .edge-pattern-solid {
    stroke-width: 1.5px !important;
  }

  /* ============ BLOQUES ESTRATEGICOS (CSS Grid Cards) ============ */
  .bloques-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }

  .bloque-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 22px 20px;
    border-top: 4px solid transparent;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .bloque-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.06);
  }

  .bloque-card--red { border-top-color: var(--red); }
  .bloque-card--green { border-top-color: var(--green); }
  .bloque-card--blue { border-top-color: var(--blue); }
  .bloque-card--amber { border-top-color: var(--amber); }
  .bloque-card--purple { border-top-color: var(--purple); }

  .bloque-card__num {
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 6px;
  }
  .bloque-card--red .bloque-card__num { color: var(--red); }
  .bloque-card--green .bloque-card__num { color: var(--green); }
  .bloque-card--blue .bloque-card__num { color: var(--blue); }
  .bloque-card--amber .bloque-card__num { color: var(--amber); }
  .bloque-card--purple .bloque-card__num { color: var(--purple); }

  .bloque-card__title {
    font-family: var(--font-display);
    font-size: 19px;
    font-weight: 700;
    margin-bottom: 8px;
    letter-spacing: -0.3px;
  }

  .bloque-card__desc {
    font-size: 14px;
    color: var(--text-dim);
    line-height: 1.55;
    margin-bottom: 10px;
  }

  .bloque-card__evidence {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--text-muted);
    line-height: 1.5;
    padding-top: 10px;
    border-top: 1px solid var(--border);
  }

  /* ============ CHART CONTAINER ============ */
  .chart-container {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
  }
  .chart-container canvas {
    max-height: 340px;
  }

  .chart-legend {
    display: flex;
    gap: 24px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border);
  }
  .chart-legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--text-dim);
  }
  .chart-legend-swatch {
    width: 14px;
    height: 14px;
    border-radius: 4px;
  }

  /* ============ CALLOUT ============ */
  .callout {
    background: var(--surface);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    border-radius: 0 10px 10px 0;
    padding: 16px 20px;
    font-size: 14px;
    line-height: 1.6;
    color: var(--text-dim);
    margin-bottom: 24px;
  }
  .callout strong { color: var(--text); }

  /* ============ BALANCE TABLE ============ */
  .balance-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    line-height: 1.55;
  }
  .balance-table th {
    background: var(--surface2);
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    color: var(--text-dim);
    text-align: left;
    padding: 14px 16px;
    border-bottom: 2px solid var(--border-bright);
    white-space: nowrap;
  }
  .balance-table td {
    padding: 14px 16px;
    border-bottom: 1px solid var(--border);
    vertical-align: top;
  }
  .balance-table td.num {
    text-align: right;
    font-variant-numeric: tabular-nums;
    font-family: var(--font-mono);
    font-size: 13px;
  }
  .balance-table .row-favor td { background: var(--green-dim); }
  .balance-table .row-contra td { background: var(--red-dim); }
  .balance-table .row-total td {
    background: var(--surface2);
    font-weight: 700;
    border-top: 2px solid var(--border-bright);
    font-size: 15px;
  }
  .balance-table .row-total td.num { font-size: 14px; }
  .balance-table tbody tr:last-child td { border-bottom: none; }

  /* ============ COLLAPSIBLE DETAILS ============ */
  details.args-group {
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 10px;
  }
  details.args-group summary {
    padding: 14px 20px;
    background: var(--surface);
    font-family: var(--font-mono);
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    list-style: none;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text);
    transition: background 0.15s ease;
  }
  details.args-group summary:hover { background: var(--surface-elevated); }
  details.args-group summary::-webkit-details-marker { display: none; }
  details.args-group summary::before {
    content: '\25B8';
    font-size: 11px;
    color: var(--text-dim);
    transition: transform 0.15s ease;
  }
  details.args-group[open] summary::before { transform: rotate(90deg); }
  details.args-group .args-body {
    padding: 0;
    border-top: 1px solid var(--border);
    overflow-x: auto;
  }
  details.args-group .args-body .data-table { font-size: 13px; }
  details.args-group .args-body .data-table th { font-size: 9px; }
  details.args-group .args-body .data-table td { padding: 10px 14px; }

  .status--nuevo { background: var(--blue-dim); color: var(--blue); }

  .args-count {
    font-family: var(--font-mono);
    font-size: 10px;
    padding: 2px 8px;
    border-radius: 5px;
    background: var(--accent-dim);
    color: var(--text-dim);
    margin-left: auto;
  }

  /* ============ TIMELINE ============ */
  .timeline {
    position: relative;
    padding: 20px 0;
    margin-bottom: 24px;
  }
  .timeline::before {
    content: '';
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--border-bright);
    transform: translateX(-50%);
  }
  .tl-item {
    position: relative;
    width: 50%;
    padding: 0 32px 36px;
  }
  .tl-item:nth-child(odd) {
    left: 0;
    text-align: right;
    padding-right: 40px;
    padding-left: 0;
  }
  .tl-item:nth-child(even) {
    left: 50%;
    text-align: left;
    padding-left: 40px;
    padding-right: 0;
  }
  .tl-dot {
    position: absolute;
    top: 4px;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 3px solid var(--surface);
    z-index: 2;
  }
  .tl-item:nth-child(odd) .tl-dot { right: -7px; }
  .tl-item:nth-child(even) .tl-dot { left: -7px; }
  .tl-dot--cgr { background: var(--red); }
  .tl-dot--defensa { background: var(--blue); }
  .tl-dot--contexto { background: var(--text-muted); }

  .tl-date {
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-dim);
    margin-bottom: 4px;
  }
  .tl-title {
    font-family: var(--font-display);
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 4px;
    letter-spacing: -0.2px;
  }
  .tl-desc {
    font-size: 13px;
    color: var(--text-dim);
    line-height: 1.5;
  }
  .tl-tag {
    display: inline-block;
    font-family: var(--font-mono);
    font-size: 9px;
    font-weight: 600;
    padding: 2px 7px;
    border-radius: 4px;
    margin-top: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .tl-tag--cgr { background: var(--red-dim); color: var(--red); }
  .tl-tag--defensa { background: var(--blue-dim); color: var(--blue); }
  .tl-tag--contexto { background: var(--accent-dim); color: var(--text-dim); }

  /* ============ FODA (SWOT) GRID ============ */
  .foda-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 24px;
  }
  .foda-grid > * { min-width: 0; overflow-wrap: break-word; }
  .foda-col {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }
  .foda-header {
    padding: 14px 20px;
    font-family: var(--font-display);
    font-size: 17px;
    font-weight: 700;
    letter-spacing: -0.3px;
    border-bottom: 2px solid transparent;
  }
  .foda-col--green .foda-header {
    background: var(--green-dim);
    color: var(--green);
    border-bottom-color: var(--green);
  }
  .foda-col--red .foda-header {
    background: var(--red-dim);
    color: var(--red);
    border-bottom-color: var(--red);
  }
  .foda-list {
    list-style: none;
    padding: 16px 20px;
    margin: 0;
  }
  .foda-list li {
    padding: 10px 0 10px 16px;
    position: relative;
    font-size: 14px;
    line-height: 1.55;
    border-bottom: 1px solid var(--border);
  }
  .foda-list li:last-child { border-bottom: none; }
  .foda-list li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 16px;
    width: 6px;
    height: 6px;
    border-radius: 50%;
  }
  .foda-col--green .foda-list li::before { background: var(--green); }
  .foda-col--red .foda-list li::before { background: var(--red); }
  .foda-list li small {
    display: block;
    color: var(--text-dim);
    font-size: 12px;
    margin-top: 2px;
  }

  /* ============ STEPS LIST ============ */
  .steps-list {
    list-style: none;
    padding: 0;
    margin: 0 0 24px;
    counter-reset: steps;
  }
  .steps-list li {
    counter-increment: steps;
    position: relative;
    padding: 18px 20px 18px 68px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    margin-bottom: 10px;
    font-size: 15px;
    line-height: 1.55;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }
  .steps-list li:hover {
    transform: translateX(4px);
    box-shadow: 0 2px 12px rgba(0,0,0,0.05);
  }
  .steps-list li::before {
    content: counter(steps);
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: var(--accent-dim);
    color: var(--accent);
    font-family: var(--font-mono);
    font-size: 14px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .steps-list li strong { color: var(--text); }
  .steps-list li small {
    display: block;
    color: var(--text-dim);
    font-size: 13px;
    margin-top: 3px;
  }

  /* ============ RESPONSIVE ============ */
  @media (max-width: 1000px) {
    .wrap { grid-template-columns: 1fr; padding-top: 0; }
    body { padding-top: 0; }

    .toc {
      position: sticky;
      top: 0;
      z-index: 200;
      max-height: none;
      display: flex;
      gap: 4px;
      align-items: center;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      padding: 10px 0;
      margin: 0 -40px;
      padding-left: 40px;
      padding-right: 40px;
      grid-row: auto;
    }
    .toc::-webkit-scrollbar { display: none; }
    .toc-title { display: none; }

    .toc a {
      white-space: nowrap;
      flex-shrink: 0;
      border-left: none;
      border-bottom: 2px solid transparent;
      border-radius: 4px 4px 0 0;
      padding: 6px 10px;
      font-size: 10px;
    }
    .toc a.active {
      border-left: none;
      border-bottom-color: var(--accent);
      background: var(--surface);
    }

    .main { padding-top: 20px; }
    .sec-head { scroll-margin-top: 52px; }
  }

  @media (max-width: 768px) {
    body { padding: 16px; }
    .hero h1 { font-size: 28px; }
    h2 { font-size: 22px; }
    .kpi-row { grid-template-columns: repeat(2, 1fr); }
    .kpi-card__value { font-size: 26px; }
    .bloques-grid { grid-template-columns: 1fr; }
    .mermaid-wrap { padding: 16px 12px; }
    .foda-grid { grid-template-columns: 1fr; }
    .timeline::before { left: 16px; }
    .tl-item { width: 100%; left: 0 !important; text-align: left !important; padding-left: 44px !important; padding-right: 0 !important; }
    .tl-item .tl-dot { left: 9px !important; right: auto !important; }
  }
</style>
</head>
<body>

<button class="theme-toggle" id="themeToggle" title="Cambiar tema" aria-label="Cambiar tema claro/oscuro">
  <span id="themeIcon">&#9789;</span>
</button>

<div class="wrap">

  <nav class="toc" id="toc">
    <div class="toc-title">Contenido</div>
    <a href="#hero">Resumen</a>
    <a href="#s1">1. Hallazgos CGR</a>
    <a href="#s2">2. Embudo V2</a>
    <a href="#s3">3. Mapa de Batalla</a>
    <a href="#s4">4. Bloques Estrategicos</a>
    <a href="#s5">5. Clasificacion V2</a>
    <a href="#s6">6. Balance Economico</a>
    <a href="#s7">7. Vigencia Args</a>
    <a href="#s8">8. Cronologia</a>
    <a href="#s9">9. FODA</a>
    <a href="#s10">10. Proximos Pasos</a>
  </nav>

  <div class="main">

    <!-- ==================== HERO ==================== -->
    <div class="hero animate" style="--i:0" id="hero">
      <h1>Estrategia de Defensa<br>PRF-80011</h1>
      <p class="hero-subtitle">Proceso de Responsabilidad Fiscal &mdash; Contraloria General de la Republica &mdash; Analisis V2</p>
    </div>

    <div class="kpi-row">
      <div class="kpi-card animate-scale" style="--i:1">
        <div class="kpi-card__value">$8,063M</div>
        <div class="kpi-card__label">Total Cto. 774 (V2)</div>
      </div>
      <div class="kpi-card animate-scale" style="--i:2">
        <div class="kpi-card__value" style="color:var(--red)">$1,236M</div>
        <div class="kpi-card__label">Comparable</div>
        <span class="kpi-card__badge badge-red">Solo 15.3%</span>
      </div>
      <div class="kpi-card animate-scale" style="--i:3">
        <div class="kpi-card__value" style="color:var(--green)">85%</div>
        <div class="kpi-card__label">NO es sobrecosto</div>
      </div>
      <div class="kpi-card animate-scale" style="--i:4">
        <div class="kpi-card__value" style="color:var(--blue)">19+</div>
        <div class="kpi-card__label">Argumentos de defensa</div>
      </div>
    </div>

    <div class="veredicto animate" style="--i:5">
      <div class="veredicto__text">NO existe dano patrimonial al Estado</div>
      <div class="veredicto__sub">V2 reduce el cuestionamiento de $3,595M a $1,236M. Inflacion 2019-2023 lo justifica.</div>
    </div>

    <!-- ==================== SECCION 1 ==================== -->
    <div id="s1" class="sec-head animate" style="--i:6">1 &mdash; Que Dice la Contraloria</div>

    <h2 class="animate" style="--i:7">6 Hallazgos Originales (OF1122)</h2>
    <p class="section-intro animate" style="--i:8">
      La Contraloria General de la Republica identifico seis hallazgos en el Oficio 1122. El Concepto Tecnico V2 reclasifica y reduce el supuesto sobrecosto.
    </p>

    <div class="table-wrap animate" style="--i:9">
      <div class="table-scroll">
        <table class="data-table">
          <thead>
            <tr>
              <th>#</th>
              <th class="wide">Hallazgo</th>
              <th class="num">Monto</th>
              <th>Estado V2</th>
            </tr>
          </thead>
          <tbody>
            <tr style="--i:9">
              <td>1</td>
              <td class="wide">Contrato vencido, obras incompletas &mdash; avance 80.10% vs 85.87%</td>
              <td class="num">&mdash;</td>
              <td><span class="status status--vigente">Vigente</span></td>
            </tr>
            <tr style="--i:10">
              <td>2</td>
              <td class="wide">Deterioro de obras ejecutadas &mdash; inspeccion visual sin memorias de calculo
                <small>Falta sustentacion tecnica. Confusion desgaste natural vs deterioro.</small>
              </td>
              <td class="num">$115.5M</td>
              <td><span class="status status--vigente">Vigente</span></td>
            </tr>
            <tr style="--i:11">
              <td>3</td>
              <td class="wide">Obras no ejecutadas &mdash; 19.10% sin completar
                <small>Prorroga negada por la entidad. Entrega en estado actual.</small>
              </td>
              <td class="num">$5,317M</td>
              <td><span class="status status--vigente">Vigente</span></td>
            </tr>
            <tr style="--i:12">
              <td>4</td>
              <td class="wide">Pagado vs ejecutado: diferencia a favor contratista
                <small>$2,643M ejecutados NO pagados al CSVH (Actas 18-20)</small>
              </td>
              <td class="num">$2,643M</td>
              <td><span class="status status--parcial">Parcial</span></td>
            </tr>
            <tr style="--i:13">
              <td>5</td>
              <td class="wide">Deficiencias en estudios y disenos
                <small>Responsabilidad de la entidad contratante (Memorando 978)</small>
              </td>
              <td class="num">&mdash;</td>
              <td><span class="status status--vigente">Vigente</span></td>
            </tr>
            <tr style="--i:14">
              <td>6</td>
              <td class="wide">Funcionalidad y operacion NO cumplida
                <small>V2 implicitamente reconoce que las obras eran necesarias para funcionalidad</small>
              </td>
              <td class="num">&mdash;</td>
              <td><span class="status status--actualiza">V2 actualiza</span></td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="2">6 hallazgos revisados</td>
              <td></td>
              <td>V2 reclasifica y reduce</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <div class="callout animate" style="--i:15">
      <strong>Nota clave.</strong> El Concepto Tecnico V2 se enfoca exclusivamente en la comparacion de costos Cto. 284 vs 774. Los hallazgos originales de deterioro, avance y disenos siguen vigentes como argumentos de defensa independientes.
    </div>

    <!-- ==================== SECCION 2 ==================== -->
    <div id="s2" class="sec-head animate" style="--i:16">2 &mdash; Embudo de Cifras V2</div>

    <h2 class="animate" style="--i:17">De $8,063M a $0 de dano real</h2>
    <p class="section-intro animate" style="--i:18">
      El V2 descompone el valor total del Contrato 774 en cuatro categorias. Solo el 15.3% ($1,236M) es directamente comparable &mdash; y queda justificado por inflacion.
    </p>

    <div class="mermaid-wrap animate" style="--i:19">
      <div class="zoom-controls">
        <button onclick="zoomDiagram(this, 1.2)" title="Zoom in">+</button>
        <button onclick="zoomDiagram(this, 0.8)" title="Zoom out">&minus;</button>
        <button onclick="resetZoom(this)" title="Reset zoom">&#8634;</button>
      </div>
      <pre class="mermaid">
flowchart TD
    TOTAL["TOTAL Cto. 774<br/>$8,063M"]
    COMP{"Es comparable<br/>con Cto. 284?"}
    NO_I["I: Cambio especificaciones<br/>$4,605M (57.1%)"]
    NO_F["F: Mismo VU que 284<br/>$1,743M (21.6%)"]
    NO_C["C: Actividades nuevas<br/>$478M (5.9%)"]
    SI_H["H: Mayor VU similares<br/>$1,236M (15.3%)"]
    JUST{"Justificado por<br/>inflacion 2019-2023?"}
    INFL["Inflacion >30% en 4 anos<br/>+ Precios fijados por<br/>Gobernacion de Antioquia"]
    CERO["$0 Dano patrimonial"]

    TOTAL --> COMP
    COMP -->|"NO"| NO_I
    COMP -->|"NO"| NO_F
    COMP -->|"NO"| NO_C
    COMP -->|"SI"| SI_H
    SI_H --> JUST
    JUST -->|"SI"| INFL
    INFL --> CERO

    classDef cgr fill:#b91c1c22,stroke:#b91c1c,stroke-width:2px
    classDef fav fill:#15803d22,stroke:#15803d,stroke-width:2px
    classDef just fill:#1d4ed822,stroke:#1d4ed8,stroke-width:2px
    classDef neutral fill:#b4530922,stroke:#b45309,stroke-width:1.5px
    classDef result fill:#15803d33,stroke:#15803d,stroke-width:2.5px

    class TOTAL cgr
    class NO_I,NO_F,NO_C fav
    class SI_H neutral
    class JUST,INFL just
    class CERO result
      </pre>
    </div>

    <div class="callout animate" style="--i:20">
      <strong>84.7% NO es comparable.</strong> La CGR acepta en el V2 que $6,827M (categorias I, F, C) no constituyen sobrecosto. Solo la categoria H ($1,236M) queda bajo analisis, y se explica por la actualizacion de precios tras 4 anos.
    </div>

    <!-- ==================== SECCION 3 ==================== -->
    <div id="s3" class="sec-head animate" style="--i:21">3 &mdash; Mapa de Batalla</div>

    <h2 class="animate" style="--i:22">CGR Argumenta vs. Defensa Responde</h2>
    <p class="section-intro animate" style="--i:23">
      Mapa completo de los argumentos de la Contraloria versus las lineas de defensa del Consorcio San Vicente HIDOR.
    </p>

    <div class="mermaid-wrap animate" style="--i:24">
      <div class="zoom-controls">
        <button onclick="zoomDiagram(this, 1.2)" title="Zoom in">+</button>
        <button onclick="zoomDiagram(this, 0.8)" title="Zoom out">&minus;</button>
        <button onclick="resetZoom(this)" title="Reset zoom">&#8634;</button>
      </div>
      <pre class="mermaid">
mindmap
  root((PRF-80011))
    CGR Argumenta
      Mayor valor $3,595M
        V2 reduce a $1,236M
      Deterioros $115M
        Sin memorias de calculo
      Obras incompletas 19%
        Prorroga negada
      Pagado vs ejecutado
        A favor CSVH $2,643M
      Deficiencias disenos
        Responsabilidad entidad
      No funcionalidad
        Obras eran necesarias
    Defensa Responde
      Juridico ELIMINATORIO
        No gestor fiscal
        Sentencia BAAN vs IDEA
        Recurso pierde condicion
      V2 a nuestro favor
        $4,605M no comparables
        $1,743M sin sobrecosto
        $478M eran necesarios
      Inflacion justifica
        30% en 4 anos
        Gobernacion fijo precios
        Item 6.2.50 distorsiona
      Args vigentes Cto 284
        Avance real 85.87%
        Deterioro post-entrega
        Disenos responsabilidad
      Balance integral
        Saldo neto +$8,362M
        No dano patrimonial
      </pre>
    </div>

    <!-- ==================== SECCION 4 ==================== -->
    <div id="s4" class="sec-head animate" style="--i:25">4 &mdash; Bloques Estrategicos</div>

    <h2 class="animate" style="--i:26">5 Lineas de Defensa</h2>
    <p class="section-intro animate" style="--i:27">
      La estrategia de defensa se estructura en cinco bloques complementarios, desde el argumento juridico eliminatorio hasta el balance economico integral.
    </p>

    <div class="bloques-grid">
      <div class="bloque-card bloque-card--red animate" style="--i:28">
        <div class="bloque-card__num">Bloque 1</div>
        <div class="bloque-card__title">Juridico</div>
        <div class="bloque-card__desc">
          OR Ingenieria NO es gestor fiscal. No administra recursos publicos. Argumento eliminatorio que impide la imputacion de responsabilidad fiscal.
        </div>
        <div class="bloque-card__evidence">
          C-840/2001, C-563/1998, Ley 610/2000, Sentencia BAAN vs IDEA (CE Nov 2015)
        </div>
      </div>

      <div class="bloque-card bloque-card--green animate" style="--i:29">
        <div class="bloque-card__num">Bloque 2</div>
        <div class="bloque-card__title">V2 Favorable</div>
        <div class="bloque-card__desc">
          $6,827M NO son sobrecosto. La CGR acepta que las categorias I ($4,605M), F ($1,743M) y C ($478M) no constituyen mayor valor imputable.
        </div>
        <div class="bloque-card__evidence">
          Concepto Tecnico V2, paginas 21-24. Tabla 17 desglosada.
        </div>
      </div>

      <div class="bloque-card bloque-card--blue animate" style="--i:30">
        <div class="bloque-card__num">Bloque 3</div>
        <div class="bloque-card__title">Inflacion Justifica</div>
        <div class="bloque-card__desc">
          Los $1,236M de diferencia en valor unitario se explican por la inflacion acumulada 2019-2023 (>30%). Los precios fueron fijados por la Gobernacion, no por el CSVH.
        </div>
        <div class="bloque-card__evidence">
          IPC 2019-2023, proceso licitatorio Cto. 774, presupuesto oficial Gobernacion.
        </div>
      </div>

      <div class="bloque-card bloque-card--amber animate" style="--i:31">
        <div class="bloque-card__num">Bloque 4</div>
        <div class="bloque-card__title">Argumentos Vigentes</div>
        <div class="bloque-card__desc">
          Los hallazgos del OF1122 sobre deterioro, progreso de obra y disenos mantienen su fuerza. Responsabilidad post-entrega y avance documentado al 85.87%.
        </div>
        <div class="bloque-card__evidence">
          Acta 85 Recibo Final, Informes Interventoria, Memorando 978, SECOP.
        </div>
      </div>

      <div class="bloque-card bloque-card--purple animate" style="--i:32">
        <div class="bloque-card__num">Bloque 5</div>
        <div class="bloque-card__title">Balance Integral</div>
        <div class="bloque-card__desc">
          Saldo neto a favor del CSVH de aproximadamente $8,362M. La entidad recibio mas obras de las cuestionadas. No existe dano patrimonial al Estado.
        </div>
        <div class="bloque-card__evidence">
          V2 pag. 24, Actas 18-20, balance: $9,598M favor vs $1,236M cuestionado.
        </div>
      </div>
    </div>

    <!-- ==================== SECCION 5 ==================== -->
    <div id="s5" class="sec-head animate" style="--i:33">5 &mdash; Clasificacion V2</div>

    <h2 class="animate" style="--i:34">Desglose por Categoria</h2>
    <p class="section-intro animate" style="--i:35">
      El Concepto Tecnico V2 clasifica los $8,063M del Contrato 774 en cuatro categorias. Solo la (H) es directamente comparable con el Contrato 284.
    </p>

    <div class="table-wrap animate" style="--i:36">
      <div class="table-scroll">
        <table class="data-table">
          <thead>
            <tr>
              <th>Cat.</th>
              <th class="wide">Descripcion</th>
              <th class="num">Monto</th>
              <th class="num">%</th>
              <th>Comparable?</th>
              <th class="wide">Argumento</th>
            </tr>
          </thead>
          <tbody>
            <tr style="--i:37">
              <td><strong style="color:var(--amber)">H</strong></td>
              <td class="wide">Mayor valor unitario items completamente similares
                <small>Diferencia en VU entre Cto. 284 y 774 para items identicos</small>
              </td>
              <td class="num">$1,236,658,993</td>
              <td class="num">15.3%</td>
              <td><span class="status status--red">SI</span></td>
              <td class="wide">Inflacion 2019-2023 (>30%). Precios fijados por Gobernacion. Item 6.2.50 distorsiona 34% del total.</td>
            </tr>
            <tr style="--i:38">
              <td><strong style="color:var(--green)">F</strong></td>
              <td class="wide">Cantidades ejecutadas al valor unitario del Cto. 284
                <small>Mismo VU: sin sobrecosto. CGR no lo imputa.</small>
              </td>
              <td class="num">$1,743,456,486</td>
              <td class="num">21.6%</td>
              <td><span class="status status--victoria">NO</span></td>
              <td class="wide">Sin controversia. Mismo precio, misma actividad.</td>
            </tr>
            <tr style="--i:39">
              <td><strong style="color:var(--blue)">I</strong></td>
              <td class="wide">Actividades con cambio de especificaciones
                <small>Materiales, procesos o normas diferentes entre contratos</small>
              </td>
              <td class="num">$4,605,210,536</td>
              <td class="num">57.1%</td>
              <td><span class="status status--victoria">NO</span></td>
              <td class="wide">CGR acepta: no son directamente comparables. Victoria del CSVH.</td>
            </tr>
            <tr style="--i:40">
              <td><strong style="color:var(--purple)">C</strong></td>
              <td class="wide">Actividades no contempladas en Cto. 284
                <small>Items nuevos necesarios para terminar el proyecto</small>
              </td>
              <td class="num">$478,592,535</td>
              <td class="num">5.9%</td>
              <td><span class="status status--victoria">NO</span></td>
              <td class="wide">CGR confirma: eran necesarias para funcionalidad. No hay alternativa contractual.</td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td></td>
              <td><strong>TOTAL Contrato 774</strong></td>
              <td class="num"><strong>$8,063,918,551</strong></td>
              <td class="num"><strong>100%</strong></td>
              <td></td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

    <div class="chart-container animate" style="--i:41">
      <canvas id="doughnutChart"></canvas>
      <div class="chart-legend">
        <div class="chart-legend-item">
          <div class="chart-legend-swatch" style="background:var(--red)"></div>
          Comparable: 15.3% ($1,236M)
        </div>
        <div class="chart-legend-item">
          <div class="chart-legend-swatch" style="background:var(--green)"></div>
          No comparable: 84.7% ($6,827M)
        </div>
      </div>
    </div>

    <div class="callout animate" style="--i:42">
      <strong>Conclusion.</strong> De los $8,063M del Contrato 774, unicamente $1,236M (15.3%) son directamente comparables con el Contrato 284. Esta diferencia se explica completamente por la inflacion acumulada de 2019 a 2023 y los precios oficiales fijados por la Gobernacion de Antioquia, eliminando cualquier pretension de dano patrimonial.
    </div>

    <!-- ==================== SECCION 6 ==================== -->
    <div id="s6" class="sec-head animate" style="--i:43">6 &mdash; Balance Economico</div>

    <h2 class="animate" style="--i:44">El Saldo Favorece al CSVH</h2>
    <p class="section-intro animate" style="--i:45">
      Comparacion integral de lo que la entidad ahorro (obra no ejecutada, descuentos, saldos pendientes) versus lo unico cuestionable ($1,236M). El resultado: un saldo neto superior a $8,000M a favor del Consorcio.
    </p>

    <div class="table-wrap animate" style="--i:46">
      <div class="table-scroll">
        <table class="balance-table">
          <thead>
            <tr>
              <th>Concepto</th>
              <th class="num">Monto</th>
              <th>Direccion</th>
            </tr>
          </thead>
          <tbody>
            <tr class="row-favor">
              <td><strong>Obra no ejecutada Cto. 284</strong>
                <small>Valor pendiente de ejecucion que la entidad conserva</small>
              </td>
              <td class="num">$5,711,888,720</td>
              <td><span class="status status--vigente">A favor CSVH</span></td>
            </tr>
            <tr class="row-favor">
              <td><strong>Descuentos al contratista Cto. 284</strong>
                <small>Deducciones aplicadas al CSVH durante la ejecucion</small>
              </td>
              <td class="num">$1,243,833,815</td>
              <td><span class="status status--vigente">A favor CSVH</span></td>
            </tr>
            <tr class="row-favor">
              <td><strong>Obras ejecutadas no pagadas (Actas 18-20)</strong>
                <small>Trabajo realizado por el CSVH sin contraprestacion</small>
              </td>
              <td class="num">$2,643,017,795</td>
              <td><span class="status status--vigente">A favor CSVH</span></td>
            </tr>
            <tr style="background:var(--surface2)">
              <td><strong>Subtotal a favor CSVH</strong></td>
              <td class="num" style="font-weight:700; color:var(--green)">$9,598,740,330</td>
              <td></td>
            </tr>
            <tr class="row-contra">
              <td><strong>Mayor valor items similares (H)</strong>
                <small>Unico concepto comparable segun V2 &mdash; explicable por inflacion</small>
              </td>
              <td class="num">$1,236,658,993</td>
              <td><span class="status status--red">En contra</span></td>
            </tr>
            <tr class="row-total">
              <td><strong>SALDO NETO</strong></td>
              <td class="num" style="color:var(--green)">+$8,362,081,337</td>
              <td><span class="status status--vigente">A favor CSVH</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="chart-container animate" style="--i:47">
      <canvas id="balanceChart" height="140"></canvas>
    </div>

    <div class="callout animate" style="--i:48">
      <strong>Sin dano patrimonial.</strong> La entidad conservo $5,711M en obras no ejecutadas, aplico $1,243M en descuentos, y le debe al CSVH $2,643M por obras realizadas sin pago. El unico cuestionamiento comparable ($1,236M) es ampliamente absorbido por el saldo a favor.
    </div>

    <!-- ==================== SECCION 7 ==================== -->
    <div id="s7" class="sec-head animate" style="--i:49">7 &mdash; Vigencia de Argumentos</div>

    <h2 class="animate" style="--i:50">19+ Argumentos Organizados por Origen</h2>
    <p class="section-intro animate" style="--i:51">
      Evaluacion del estado de cada argumento de defensa tras la publicacion del Concepto Tecnico V2. Los argumentos se organizan por bloque temporal y se clasifican segun su vigencia actual.
    </p>

    <!-- Oct 2023 -->
    <details class="args-group animate" style="--i:52" open>
      <summary>
        <span style="color:var(--amber)">Octubre 2023</span> &mdash; Respuesta a OF1122 (Cto. 284)
        <span class="args-count">8 argumentos</span>
      </summary>
      <div class="args-body">
        <table class="data-table">
          <thead>
            <tr><th>#</th><th class="wide">Argumento</th><th>Estado</th><th>Accion</th><th>Prioridad</th></tr>
          </thead>
          <tbody>
            <tr><td>1</td><td class="wide">Deterioros &mdash; responsabilidad post-entrega<small>Custodia paso a la entidad tras Acta 85</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
            <tr><td>2</td><td class="wide">Deterioros &mdash; falta sustentacion tecnica CGR<small>Inspeccion visual sin memorias de calculo</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
            <tr><td>3</td><td class="wide">Deterioros &mdash; confusion desgaste natural vs deterioro</td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-amber" style="font-size:10px; padding:2px 6px; border-radius:4px">Media</span></td></tr>
            <tr><td>4</td><td class="wide">Avance 80.10% vs 85.87% &mdash; documentacion primaria<small>Actas de construccion e informes de interventoria</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
            <tr><td>5</td><td class="wide">Avance real 85.87% segun registros oficiales</td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
            <tr><td>6</td><td class="wide">Items no ejecutados &mdash; falta soporte CGR<small>Sin desglose detallado del porcentaje faltante</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-amber" style="font-size:10px; padding:2px 6px; border-radius:4px">Media</span></td></tr>
            <tr><td>7</td><td class="wide">Estudios/disenos &mdash; responsabilidad de la entidad<small>Memorando 978 sin respuesta de la Gobernacion</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
            <tr><td>8</td><td class="wide">Obra parcial SI es funcional<small>Comunidad ya usa la infraestructura</small></td><td><span class="status status--parcial">Parcial</span></td><td>Reforzar</td><td><span class="badge-amber" style="font-size:10px; padding:2px 6px; border-radius:4px">Media</span></td></tr>
          </tbody>
        </table>
      </div>
    </details>

    <!-- Oct 2024 -->
    <details class="args-group animate" style="--i:53">
      <summary>
        <span style="color:var(--blue)">Octubre 2024</span> &mdash; Refutacion de costos (Cto. 284 vs 774)
        <span class="args-count">7 argumentos</span>
      </summary>
      <div class="args-body">
        <table class="data-table">
          <thead>
            <tr><th>#</th><th class="wide">Argumento</th><th>Estado</th><th>Accion</th><th>Prioridad</th></tr>
          </thead>
          <tbody>
            <tr><td>R1</td><td class="wide">Items NO comparables entre Cto. 284 y 774<small>Victoria: CGR acepta separar $4,605M</small></td><td><span class="status status--vigente">Vigente</span></td><td>Explotar victoria</td><td><span class="badge-green" style="font-size:10px; padding:2px 6px; border-radius:4px">Critica</span></td></tr>
            <tr><td>R2</td><td class="wide">Diferencia real $606M vs $2,981M<small>V2 llega a $1,236M (mejora sustancial)</small></td><td><span class="status status--parcial">Parcial</span></td><td>Actualizar cifras</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
            <tr><td>R3</td><td class="wide">No responsabilidad del CSVH por sobrecostos<small>Gobernacion fijo precios, prorroga negada</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
            <tr><td>R4</td><td class="wide">Menores cantidades compensan<small>Incorporado en Tabla 8 del V2</small></td><td><span class="status status--parcial">Parcial</span></td><td>Actualizar</td><td><span class="badge-amber" style="font-size:10px; padding:2px 6px; border-radius:4px">Media</span></td></tr>
            <tr><td>R5</td><td class="wide">Actividades nuevas ($478M) eran necesarias<small>Victoria: CGR confirma necesidad</small></td><td><span class="status status--vigente">Vigente</span></td><td>Explotar victoria</td><td><span class="badge-green" style="font-size:10px; padding:2px 6px; border-radius:4px">Critica</span></td></tr>
            <tr><td>R6</td><td class="wide">Valores unitarios fijados por la Gobernacion<small>CSVH no participo en definir precios del Cto. 774</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-green" style="font-size:10px; padding:2px 6px; border-radius:4px">Critica</span></td></tr>
            <tr><td>R7</td><td class="wide">Interventoria adicional ($915M) no imputable<small>Decision de la entidad contratante</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
          </tbody>
        </table>
      </div>
    </details>

    <!-- Juridicos -->
    <details class="args-group animate" style="--i:54">
      <summary>
        <span style="color:var(--red)">Juridicos</span> &mdash; Argumento eliminatorio (Version Libre)
        <span class="args-count">4 argumentos</span>
      </summary>
      <div class="args-body">
        <table class="data-table">
          <thead>
            <tr><th>#</th><th class="wide">Argumento</th><th>Estado</th><th>Accion</th><th>Prioridad</th></tr>
          </thead>
          <tbody>
            <tr><td>J1</td><td class="wide">CSVH NO es gestor fiscal<small>C-840/2001, C-563/1998, Ley 610/2000. Sin gestion fiscal no hay responsabilidad.</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener como principal</td><td><span class="badge-green" style="font-size:10px; padding:2px 6px; border-radius:4px">Critica</span></td></tr>
            <tr><td>J2</td><td class="wide">Sentencia BAAN vs IDEA (CE Nov 2015)<small>Caso analogo: contratista NO ejerce gestion fiscal</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-green" style="font-size:10px; padding:2px 6px; border-radius:4px">Critica</span></td></tr>
            <tr><td>J3</td><td class="wide">Recurso publico pierde condicion al pagarse<small>Davila Vinueza, Uriel Amaya, Laudo ANI</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
            <tr><td>J4</td><td class="wide">Solidaridad art. 119 Ley 1474/2011 mal aplicada<small>Jurisprudencia Consejo de Estado</small></td><td><span class="status status--vigente">Vigente</span></td><td>Mantener</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
          </tbody>
        </table>
      </div>
    </details>

    <!-- Nuevos V2 -->
    <details class="args-group animate" style="--i:55">
      <summary>
        <span style="color:var(--green)">Nuevos V2</span> &mdash; Argumentos derivados del Concepto Tecnico V2
        <span class="args-count">5 argumentos</span>
      </summary>
      <div class="args-body">
        <table class="data-table">
          <thead>
            <tr><th>#</th><th class="wide">Argumento</th><th>Estado</th><th>Accion</th><th>Prioridad</th></tr>
          </thead>
          <tbody>
            <tr><td>N1</td><td class="wide">Inflacion 2019-2023 justifica mayor VU<small>IPC acumulado >30%, COVID, crisis global de materiales</small></td><td><span class="status status--nuevo">Nuevo</span></td><td>Desarrollar calculo DANE</td><td><span class="badge-green" style="font-size:10px; padding:2px 6px; border-radius:4px">Critica</span></td></tr>
            <tr><td>N2</td><td class="wide">Item 6.2.50 distorsiona el calculo<small>$207M (34% de VU) en un solo item Global (puente)</small></td><td><span class="status status--nuevo">Nuevo</span></td><td>Desarrollar analisis</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
            <tr><td>N3</td><td class="wide">$4,605M confirmados no comparables<small>CGR acepta explicitamente la tesis del CSVH</small></td><td><span class="status status--nuevo">Nuevo</span></td><td>Citar textualmente V2</td><td><span class="badge-green" style="font-size:10px; padding:2px 6px; border-radius:4px">Critica</span></td></tr>
            <tr><td>N4</td><td class="wide">Adicion Cto. 284 no oficializada<small>CGR reconoce que se requeria adicion que no se hizo</small></td><td><span class="status status--nuevo">Nuevo</span></td><td>Desarrollar</td><td><span class="badge-red" style="font-size:10px; padding:2px 6px; border-radius:4px">Alta</span></td></tr>
            <tr><td>N5</td><td class="wide">Balance economico integral favorece al CSVH<small>Saldo neto +$8,362M a favor</small></td><td><span class="status status--nuevo">Nuevo</span></td><td>Presentar con tabla</td><td><span class="badge-green" style="font-size:10px; padding:2px 6px; border-radius:4px">Critica</span></td></tr>
          </tbody>
        </table>
      </div>
    </details>

    <div class="callout animate" style="--i:56">
      <strong>Resumen.</strong> 16 argumentos <span class="status status--vigente" style="font-size:9px">Vigente</span>, 3 <span class="status status--parcial" style="font-size:9px">Parcial</span>, 5 <span class="status status--nuevo" style="font-size:9px">Nuevo</span>. Ningun argumento ha sido refutado o declarado obsoleto por el V2. La defensa se fortalece.
    </div>

    <!-- ==================== SECCION 8 ==================== -->
    <div id="s8" class="sec-head animate" style="--i:57">8 &mdash; Linea de Tiempo</div>

    <h2 class="animate" style="--i:58">Cronologia del Proceso (2019&ndash;2026)</h2>
    <p class="section-intro animate" style="--i:59">
      Desde la firma del Contrato 284 hasta el analisis estrategico actual. Los eventos CGR aparecen en rojo, las acciones de defensa en azul.
    </p>

    <div class="timeline animate" style="--i:60">
      <div class="tl-item">
        <div class="tl-dot tl-dot--contexto"></div>
        <div class="tl-date">2019</div>
        <div class="tl-title">Contrato 284 suscrito</div>
        <div class="tl-desc">Convenio No. 4600009284. Mejoramiento corredor vial Granada-San Carlos. Valor: $27,835M.</div>
        <span class="tl-tag tl-tag--contexto">Contexto</span>
      </div>

      <div class="tl-item">
        <div class="tl-dot tl-dot--contexto"></div>
        <div class="tl-date">Feb 2021</div>
        <div class="tl-title">Vencimiento Cto. 284</div>
        <div class="tl-desc">Plazo contractual finaliza. Avance: 85.87%. Prorroga solicitada NO fue otorgada por la entidad.</div>
        <span class="tl-tag tl-tag--contexto">Contexto</span>
      </div>

      <div class="tl-item">
        <div class="tl-dot tl-dot--cgr"></div>
        <div class="tl-date">Ago 2022</div>
        <div class="tl-title">Visita CGR (OF1122)</div>
        <div class="tl-desc">Contraloria realiza visita especial. 6 hallazgos: deterioros, obras incompletas, pagos, disenos, funcionalidad.</div>
        <span class="tl-tag tl-tag--cgr">CGR</span>
      </div>

      <div class="tl-item">
        <div class="tl-dot tl-dot--contexto"></div>
        <div class="tl-date">2023</div>
        <div class="tl-title">Contrato 774 adjudicado</div>
        <div class="tl-desc">Nuevo contrato No. 4600015774 para terminar las obras. Valor: $8,063M. Precios fijados por Gobernacion.</div>
        <span class="tl-tag tl-tag--contexto">Contexto</span>
      </div>

      <div class="tl-item">
        <div class="tl-dot tl-dot--defensa"></div>
        <div class="tl-date">Oct 2023</div>
        <div class="tl-title">Primera respuesta CSVH</div>
        <div class="tl-desc">8 argumentos tecnicos: deterioro post-entrega, avance 85.87%, responsabilidad de la entidad.</div>
        <span class="tl-tag tl-tag--defensa">Defensa</span>
      </div>

      <div class="tl-item">
        <div class="tl-dot tl-dot--cgr"></div>
        <div class="tl-date">Oct 2024</div>
        <div class="tl-title">Auto vinculacion + V1</div>
        <div class="tl-desc">CGR vincula al CSVH como presunto responsable fiscal. Informe OF0224-V1: mayor valor $3,595M.</div>
        <span class="tl-tag tl-tag--cgr">CGR</span>
      </div>

      <div class="tl-item">
        <div class="tl-dot tl-dot--defensa"></div>
        <div class="tl-date">Oct 2024</div>
        <div class="tl-title">Refutacion tecnica CSVH</div>
        <div class="tl-desc">7 argumentos: items no comparables, precios de Gobernacion, $606M vs $2,981M, actividades necesarias.</div>
        <span class="tl-tag tl-tag--defensa">Defensa</span>
      </div>

      <div class="tl-item">
        <div class="tl-dot tl-dot--defensa"></div>
        <div class="tl-date">Nov 2024 &ndash; Mar 2025</div>
        <div class="tl-title">Version libre y defensa juridica</div>
        <div class="tl-desc">Argumento eliminatorio: CSVH no es gestor fiscal. Jurisprudencia BAAN vs IDEA. Version libre por escrito.</div>
        <span class="tl-tag tl-tag--defensa">Defensa</span>
      </div>

      <div class="tl-item">
        <div class="tl-dot tl-dot--cgr"></div>
        <div class="tl-date">Oct 2025</div>
        <div class="tl-title">Concepto Tecnico V2</div>
        <div class="tl-desc">CGR reclasifica: acepta que $4,605M no son comparables y $478M eran necesarios. Solo $1,236M es comparable.</div>
        <span class="tl-tag tl-tag--cgr">CGR</span>
      </div>

      <div class="tl-item">
        <div class="tl-dot tl-dot--defensa"></div>
        <div class="tl-date">Feb 2026</div>
        <div class="tl-title">Analisis estrategico</div>
        <div class="tl-desc">Evaluacion integral: V2 fortalece la defensa. Balance neto +$8,362M a favor CSVH. Preparacion de respuesta formal.</div>
        <span class="tl-tag tl-tag--defensa">Defensa</span>
      </div>
    </div>

    <!-- ==================== SECCION 9 ==================== -->
    <div id="s9" class="sec-head animate" style="--i:61">9 &mdash; Fortalezas vs Debilidades</div>

    <h2 class="animate" style="--i:62">Evaluacion Estrategica</h2>
    <p class="section-intro animate" style="--i:63">
      Analisis de las fortalezas que sustentan la defensa y las debilidades que requieren atencion antes de la respuesta formal.
    </p>

    <div class="foda-grid animate" style="--i:64">
      <div class="foda-col foda-col--green">
        <div class="foda-header">Fortalezas</div>
        <ul class="foda-list">
          <li>
            <strong>V2 reduce cuestionamiento en 84.7%</strong>
            <small>De $8,063M a $1,236M comparable. La CGR aceptó la clasificacion del CSVH.</small>
          </li>
          <li>
            <strong>Argumento juridico no refutado</strong>
            <small>CSVH no es gestor fiscal. Jurisprudencia C-840/2001 y BAAN vs IDEA intactas.</small>
          </li>
          <li>
            <strong>Balance economico ampliamente a favor</strong>
            <small>Saldo neto +$8,362M. La entidad conserva mas de lo cuestionado.</small>
          </li>
          <li>
            <strong>CGR reconoce que actividades eran necesarias</strong>
            <small>$4,605M (cambio especificaciones) + $478M (nuevas) declaradas indispensables por la CGR.</small>
          </li>
          <li>
            <strong>16 de 24 argumentos siguen vigentes</strong>
            <small>El V2 no debilita ninguna linea de defensa existente.</small>
          </li>
        </ul>
      </div>
      <div class="foda-col foda-col--red">
        <div class="foda-header">Debilidades</div>
        <ul class="foda-list">
          <li>
            <strong>$1,236M en items similares persiste</strong>
            <small>Aun es necesario justificar con calculo exacto de inflacion DANE 2019-2023.</small>
          </li>
          <li>
            <strong>Proceso fiscal abierto desde 2022</strong>
            <small>4 anos de tramite. Desgaste procesal y riesgo de medida cautelar.</small>
          </li>
          <li>
            <strong>Falta calculo de inflacion DANE exacto</strong>
            <small>Se afirma >30% pero no se ha documentado el calculo preciso por item.</small>
          </li>
          <li>
            <strong>Item 6.2.50 puente La Aguada ($207M)</strong>
            <small>Distorsiona 34% del calculo. Su comparabilidad como item Global es cuestionable pero no ha sido debatida.</small>
          </li>
          <li>
            <strong>Estado de Actas 18-20 incierto</strong>
            <small>$2,643M en obras no pagadas. Se necesita verificar si hay accion legal pendiente.</small>
          </li>
        </ul>
      </div>
    </div>

    <!-- ==================== SECCION 10 ==================== -->
    <div id="s10" class="sec-head animate" style="--i:65">10 &mdash; Proximos Pasos</div>

    <h2 class="animate" style="--i:66">Plan de Accion Inmediato</h2>
    <p class="section-intro animate" style="--i:67">
      Acciones prioritarias para consolidar la defensa y preparar la respuesta formal ante la Contraloria General de la Republica.
    </p>

    <ol class="steps-list">
      <li class="animate" style="--i:68">
        <strong>Validar estrategia con abogado Javier Argote</strong>
        <small>Revisar los 5 bloques estrategicos y confirmar que el argumento juridico sigue siendo la linea principal. Coordinar presentacion de la respuesta formal.</small>
      </li>
      <li class="animate" style="--i:69">
        <strong>Calcular inflacion exacta DANE 2019&ndash;2023</strong>
        <small>Obtener IPC por item de construccion. Demostrar que la diferencia de $1,236M se explica completamente por la actualizacion de precios en 4 anos, sin necesidad de invocar ineficiencia.</small>
      </li>
      <li class="animate" style="--i:70">
        <strong>Verificar estado de Actas 18, 19 y 20</strong>
        <small>Confirmar si los $2,643M en obras ejecutadas y no pagadas tienen accion legal de cobro. Determinar si el CSVH puede reconvenir o solicitar compensacion.</small>
      </li>
      <li class="animate" style="--i:71">
        <strong>Redactar respuesta formal al Concepto Tecnico V2</strong>
        <small>Documento estructurado con los 5 bloques: (1) No gestor fiscal, (2) V2 reduce a $1,236M, (3) Inflacion justifica, (4) Argumentos vigentes, (5) Balance integral +$8,362M.</small>
      </li>
    </ol>

    <div class="callout animate" style="--i:72">
      <strong>Conclusion general.</strong> La posicion del CSVH es significativamente mas fuerte tras el V2. Con un argumento juridico eliminatorio intacto, un balance economico de +$8,362M a favor, y el reconocimiento de la CGR de que el 84.7% no es sobrecosto, la defensa esta bien fundamentada para solicitar el archivo del proceso.
    </div>

  </div><!-- /main -->
</div><!-- /wrap -->

<!-- ============ CHART.JS ============ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
<script>
  // Chart.js doughnut
  (function() {
    var isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    var textColor = isDark ? '#a09a90' : '#7a756d';
    var rootStyle = getComputedStyle(document.documentElement);

    var ctx = document.getElementById('doughnutChart');
    if (!ctx) return;

    window.__doughnutChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['H: Mayor VU similares ($1,236M)', 'F: Cantidades al VU 284 ($1,743M)', 'I: Cambio especificaciones ($4,605M)', 'C: Actividades nuevas ($478M)'],
        datasets: [{
          data: [1236658993.61, 1743456486.41, 4605210536.54, 478592535.00],
          backgroundColor: [
            isDark ? 'rgba(251, 191, 36, 0.7)' : 'rgba(180, 83, 9, 0.7)',
            isDark ? 'rgba(74, 222, 128, 0.7)' : 'rgba(21, 128, 61, 0.7)',
            isDark ? 'rgba(147, 197, 253, 0.7)' : 'rgba(29, 78, 216, 0.7)',
            isDark ? 'rgba(196, 181, 253, 0.7)' : 'rgba(126, 34, 206, 0.7)'
          ],
          borderColor: [
            isDark ? '#fbbf24' : '#b45309',
            isDark ? '#4ade80' : '#15803d',
            isDark ? '#93c5fd' : '#1d4ed8',
            isDark ? '#c4b5fd' : '#7e22ce'
          ],
          borderWidth: 2,
          hoverOffset: 8
        }]
      },
      options: {
        responsive: true,
        cutout: '55%',
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: textColor,
              font: { family: "'Crimson Pro', Georgia, serif", size: 13 },
              padding: 16,
              usePointStyle: true,
              pointStyleWidth: 12
            }
          },
          tooltip: {
            callbacks: {
              label: function(ctx) {
                var val = ctx.parsed;
                var total = ctx.dataset.data.reduce(function(a, b) { return a + b; }, 0);
                var pct = ((val / total) * 100).toFixed(1);
                return ctx.label + ': ' + pct + '%';
              }
            }
          }
        }
      }
    });
  })();

  // Chart.js horizontal bar — Balance Economico
  (function() {
    var ctx2 = document.getElementById('balanceChart');
    if (!ctx2) return;

    var isDark2 = document.documentElement.getAttribute('data-theme') === 'dark';
    var textColor2 = isDark2 ? '#a09a90' : '#7a756d';
    var gridColor2 = isDark2 ? 'rgba(255,255,255,0.06)' : 'rgba(0,0,0,0.06)';

    new Chart(ctx2, {
      type: 'bar',
      data: {
        labels: ['A favor CSVH', 'En contra'],
        datasets: [{
          data: [9598.74, 1236.66],
          backgroundColor: [
            isDark2 ? 'rgba(74, 222, 128, 0.65)' : 'rgba(21, 128, 61, 0.65)',
            isDark2 ? 'rgba(248, 113, 113, 0.65)' : 'rgba(185, 28, 28, 0.65)'
          ],
          borderColor: [
            isDark2 ? '#4ade80' : '#15803d',
            isDark2 ? '#f87171' : '#b91c1c'
          ],
          borderWidth: 2,
          borderRadius: 6,
          barPercentage: 0.6
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(ctx) {
                return '$' + ctx.parsed.x.toLocaleString('es-CO') + 'M';
              }
            }
          }
        },
        scales: {
          x: {
            beginAtZero: true,
            ticks: {
              color: textColor2,
              font: { family: "'JetBrains Mono', monospace", size: 11 },
              callback: function(val) { return '$' + val.toLocaleString() + 'M'; }
            },
            grid: { color: gridColor2 }
          },
          y: {
            ticks: {
              color: textColor2,
              font: { family: "'Crimson Pro', Georgia, serif", size: 14 }
            },
            grid: { display: false }
          }
        }
      }
    });
  })();
</script>

<!-- ============ MERMAID ============ -->
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
  import elkLayouts from 'https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk/dist/mermaid-layout-elk.esm.min.mjs';

  var isDark = document.documentElement.getAttribute('data-theme') === 'dark' ||
    (!document.documentElement.getAttribute('data-theme') && window.matchMedia('(prefers-color-scheme: dark)').matches);

  mermaid.registerLayoutLoaders(elkLayouts);
  mermaid.initialize({
    startOnLoad: true,
    theme: 'base',
    look: 'classic',
    layout: 'elk',
    themeVariables: {
      primaryColor: isDark ? '#302d27' : '#f3f0eb',
      primaryBorderColor: isDark ? '#d4a574' : '#8b5e3c',
      primaryTextColor: isDark ? '#ede8e0' : '#1c1a17',
      secondaryColor: isDark ? '#1e2a1e' : '#f0fdf0',
      secondaryBorderColor: isDark ? '#4ade80' : '#15803d',
      secondaryTextColor: isDark ? '#ede8e0' : '#1c1a17',
      tertiaryColor: isDark ? '#1e1e2e' : '#eef2ff',
      tertiaryBorderColor: isDark ? '#93c5fd' : '#1d4ed8',
      tertiaryTextColor: isDark ? '#ede8e0' : '#1c1a17',
      lineColor: isDark ? '#6b665e' : '#a09a90',
      fontSize: '15px',
      fontFamily: "'Crimson Pro', Georgia, serif",
      noteBkgColor: isDark ? '#302d27' : '#fefce8',
      noteTextColor: isDark ? '#ede8e0' : '#1c1a17',
      noteBorderColor: isDark ? '#fbbf24' : '#b45309',
    }
  });
</script>

<!-- ============ ZOOM CONTROLS ============ -->
<script>
  function updateZoomState(wrap) {
    var target = wrap.querySelector('.mermaid');
    var zoom = parseFloat(target.dataset.zoom || '1');
    wrap.classList.toggle('is-zoomed', zoom > 1);
  }

  function zoomDiagram(btn, factor) {
    var wrap = btn.closest('.mermaid-wrap');
    var target = wrap.querySelector('.mermaid');
    var current = parseFloat(target.dataset.zoom || '1');
    var next = Math.min(Math.max(current * factor, 0.3), 5);
    target.dataset.zoom = next;
    target.style.transform = 'scale(' + next + ')';
    updateZoomState(wrap);
  }

  function resetZoom(btn) {
    var wrap = btn.closest('.mermaid-wrap');
    var target = wrap.querySelector('.mermaid');
    target.dataset.zoom = '1';
    target.style.transform = 'scale(1)';
    updateZoomState(wrap);
  }

  document.querySelectorAll('.mermaid-wrap').forEach(function(wrap) {
    wrap.addEventListener('wheel', function(e) {
      if (!e.ctrlKey && !e.metaKey) return;
      e.preventDefault();
      var target = wrap.querySelector('.mermaid');
      var current = parseFloat(target.dataset.zoom || '1');
      var factor = e.deltaY < 0 ? 1.1 : 0.9;
      var next = Math.min(Math.max(current * factor, 0.3), 5);
      target.dataset.zoom = next;
      target.style.transform = 'scale(' + next + ')';
      updateZoomState(wrap);
    }, { passive: false });

    var startX, startY, scrollL, scrollT;
    wrap.addEventListener('mousedown', function(e) {
      if (e.target.closest('.zoom-controls')) return;
      var target = wrap.querySelector('.mermaid');
      if (parseFloat(target.dataset.zoom || '1') <= 1) return;
      wrap.classList.add('is-panning');
      startX = e.clientX;
      startY = e.clientY;
      scrollL = wrap.scrollLeft;
      scrollT = wrap.scrollTop;
    });
    window.addEventListener('mousemove', function(e) {
      if (!wrap.classList.contains('is-panning')) return;
      wrap.scrollLeft = scrollL - (e.clientX - startX);
      wrap.scrollTop = scrollT - (e.clientY - startY);
    });
    window.addEventListener('mouseup', function() {
      wrap.classList.remove('is-panning');
    });
  });
</script>

<!-- ============ SCROLL SPY ============ -->
<script>
(function() {
  var toc = document.getElementById('toc');
  var links = toc.querySelectorAll('a');
  var sections = [];

  links.forEach(function(link) {
    var id = link.getAttribute('href').slice(1);
    var el = document.getElementById(id);
    if (el) sections.push({ id: id, el: el, link: link });
  });

  var observer = new IntersectionObserver(function(entries) {
    entries.forEach(function(entry) {
      if (entry.isIntersecting) {
        links.forEach(function(l) { l.classList.remove('active'); });
        var match = sections.find(function(s) { return s.el === entry.target; });
        if (match) {
          match.link.classList.add('active');
          if (window.innerWidth <= 1000) {
            match.link.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
          }
        }
      }
    });
  }, { rootMargin: '-10% 0px -80% 0px' });

  sections.forEach(function(s) { observer.observe(s.el); });

  links.forEach(function(link) {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      var id = link.getAttribute('href').slice(1);
      var el = document.getElementById(id);
      if (el) {
        el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        history.replaceState(null, '', '#' + id);
      }
    });
  });
})();
</script>

<!-- ============ THEME TOGGLE ============ -->
<script>
(function() {
  var toggle = document.getElementById('themeToggle');
  var icon = document.getElementById('themeIcon');
  var html = document.documentElement;

  // Detect initial preference
  var stored = localStorage.getItem('ve-theme');
  if (stored) {
    html.setAttribute('data-theme', stored);
  } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
    html.setAttribute('data-theme', 'dark');
  }

  function updateIcon() {
    var isDark = html.getAttribute('data-theme') === 'dark';
    icon.innerHTML = isDark ? '&#9788;' : '&#9789;';
  }
  updateIcon();

  toggle.addEventListener('click', function() {
    var isDark = html.getAttribute('data-theme') === 'dark';
    var next = isDark ? 'light' : 'dark';
    html.setAttribute('data-theme', next);
    localStorage.setItem('ve-theme', next);
    updateIcon();
  });
})();
</script>

</body>
</html>
